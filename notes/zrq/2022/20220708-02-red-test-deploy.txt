#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2022, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#zrq-notes-time
#zrq-notes-indent
#zrq-notes-crypto
#zrq-notes-ansible
#zrq-notes-osformat
#zrq-notes-zeppelin
#

    Target:

        Clean deploy on red to test everything.

    Result:

        Work in progress ...

# -----------------------------------------------------
# Create a container to work with.
#[user@desktop]

    source "${HOME:?}/aglais.env"

    podman run \
        --rm \
        --tty \
        --interactive \
        --name ansibler \
        --hostname ansibler \
        --publish 3000:3000 \
        --env "SSH_AUTH_SOCK=/mnt/ssh_auth_sock" \
        --volume "${SSH_AUTH_SOCK}:/mnt/ssh_auth_sock:rw,z" \
        --volume "${HOME:?}/clouds.yaml:/etc/openstack/clouds.yaml:ro,z" \
        --volume "${AGLAIS_CODE:?}/deployments:/deployments:ro,z" \
        ghcr.io/wfau/atolmis/ansible-client:2022.03.19 \
        bash


# -----------------------------------------------------
# Set the target configuration.
#[root@ansibler]

    cloudbase=arcus
    cloudname=iris-gaia-red
    configname=zeppelin-26.43-spark-3.26.43


# -----------------------------------------------------
# Deploy everything.
#[root@ansibler]

    time \
        source /deployments/hadoop-yarn/bin/deploy.sh

    >   real    41m59.516s
    >   user    14m49.206s
    >   sys     2m52.010s


# -----------------------------------------------------
# Create a couple of users.
#[root@ansibler]

    source /deployments/zeppelin/bin/create-user-tools.sh


    createusermain "Paddington" "uncle" "paddington's key" \
    | jq '.'

    >   bash: -c: line 1: unexpected EOF while looking for matching `''
    >   bash: -c: line 3: syntax error: unexpected end of file
    >   parse error: Expected value before ',' at line 2, column 14


    createusermain "Paddington" "uncle"

    >   {
    >   "linuxuser": {
    >   "name":   "Paddington",
    >   "type":   "uncle",
    >   "home":   "/home/Paddington",
    >   "uid":    20001,
    >   "debug": {
    >       "script": "create-linux-user.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: adduser [Paddington] done","PASS: mkdir [/home/Paddington/.ssh] done","PASS: adding public key for [zepelin] done","SKIP: adding public key for [Paddington] skipped (no key)"]
    >       }
    >   },
    >   "shirouser": {
    >   "name": "Paddington",
    >   "type": "uncle",
    >   "role": "user",
    >   "pass": "phieXobao0saeviengee",
    >   "hash": "$shiro1$SHA-256$500000$F0avjLgaRlIxjAI/oIzKtw==$+oCQJd91arfllVCNQj2uONduE8gOcJDwTuZMZsrApzE=",
    >   "debug": {
    >       "script": "create-shiro-user.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: passgen done","PASS: hashpass done","PASS: database INSERT done"]
    >       }
    >   },
    >   "hdfsspace": {
    >   "path":  "/albert/Paddington",
    >   "owner": "Paddington",
    >   "group": "supergroup",
    >   "debug": {
    >       "script": "create-hdfs-space.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: hdfs mkdir [/albert/Paddington] done","PASS: hdfs chown [/albert/Paddington] done"]
    >       }
    >   },
    >   "notebooks": {
    >   "user": "Paddington",
    >   "debug": {
    >       "script": "clone-notebooks.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: Login [Paddington] done","SKIP: Examples found [8]"]
    >       }
    >   }
    >   }


    createusermain "Benjamin" "nephew" \
    | jq '.'

    >   {
    >     "linuxuser": {
    >       "name": "Benjamin",
    >       "type": "nephew",
    >       "home": "/home/Benjamin",
    >       "uid": 20002,
    >       "debug": {
    >         "script": "create-linux-user.sh",
    >         "result": "PASS",
    >         "messages": [
    >           "PASS: adduser [Benjamin] done",
    >           "PASS: mkdir [/home/Benjamin/.ssh] done",
    >           "PASS: adding public key for [zepelin] done",
    >           "SKIP: adding public key for [Benjamin] skipped (no key)"
    >         ]
    >       }
    >     },
    >     "shirouser": {
    >       "name": "Benjamin",
    >       "type": "nephew",
    >       "role": "user",
    >       "pass": "ushabeopahH2aech3iej",
    >       "hash": "$shiro1$SHA-256$500000$GFeiWAaMEpF5vdXhOCe0Sw==$w1wqo2giyQpcXDtCDK1RynXS8+5xUi0sa13dCH/39HM=",
    >       "debug": {
    >         "script": "create-shiro-user.sh",
    >         "result": "PASS",
    >         "messages": [
    >           "PASS: passgen done",
    >           "PASS: hashpass done",
    >           "PASS: database INSERT done"
    >         ]
    >       }
    >     },
    >     "hdfsspace": {
    >       "path": "/albert/Benjamin",
    >       "owner": "Benjamin",
    >       "group": "supergroup",
    >       "debug": {
    >         "script": "create-hdfs-space.sh",
    >         "result": "PASS",
    >         "messages": [
    >           "PASS: hdfs mkdir [/albert/Benjamin] done",
    >           "PASS: hdfs chown [/albert/Benjamin] done"
    >         ]
    >       }
    >     },
    >     "notebooks": {
    >       "user": "Benjamin",
    >       "debug": {
    >         "script": "clone-notebooks.sh",
    >         "result": "PASS",
    >         "messages": [
    >           "PASS: Login [Benjamin] done",
    >           "PASS: Clone done [2GRTQZFUM][/Users/Benjamin/examples/1. Start here]",
    >           "PASS: Clone done [2GRA39HCN][/Users/Benjamin/examples/2. Data holdings]",
    >           "PASS: Clone done [2GQ6WMH9W][/Users/Benjamin/examples/3. Source counts over the sky]",
    >           "PASS: Clone done [2GSNYBDWB][/Users/Benjamin/examples/4. Mean proper motions over the sky]",
    >           "PASS: Clone done [2H2YRJCKM][/Users/Benjamin/examples/5. Working with Gaia XP spectra]",
    >           "PASS: Clone done [2GZME59KY][/Users/Benjamin/examples/6. Working with cross-matched surveys]",
    >           "PASS: Clone done [2GQDKZ59J][/Users/Benjamin/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >           "PASS: Clone done [2GVXKC266][/Users/Benjamin/examples/8. Tips and tricks]"
    >         ]
    >       }
    >     }
    >   }


    createusermain "Benjamin" "nephew" "public-key"


    >   {
    >   "linuxuser": {
    >   "name":   "Benjamin",
    >   "type":   "nephew",
    >   "home":   "/home/Benjamin",
    >   "uid":    20003,
    >   "debug": {
    >       "script": "create-linux-user.sh",
    >       "result": "PASS",
    >       "messages": ["SKIP: adduser [Benjamin] skipped (done)","SKIP: mkdir [/home/Benjamin/.ssh] skipped (done)","SKIP: adding public key for [zeppelin] skipped (done)","PASS: adding public key for [Benjamin] done"]
    >       }
    >   },
    >   "shirouser": {
    >   "name": "Benjamin",
    >   "type": "nephew",
    >   "role": "user",
    >   "pass": "ohsepooX1aiquae9phoh",
    >   "hash": "$shiro1$SHA-256$500000$tUsz0sD5ihew5LTpD4hDAA==$7FSU6QwHnYofFxMCGjtaF0loxv4CoZRKWpdgrLCup+E=",
    >   "debug": {
    >       "script": "create-shiro-user.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: passgen done","PASS: hashpass done","PASS: database INSERT done"]
    >       }
    >   },
    >   "hdfsspace": {
    >   "path":  "/albert/Benjamin",
    >   "owner": "Benjamin",
    >   "group": "supergroup",
    >   "debug": {
    >       "script": "create-hdfs-space.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: hdfs mkdir [/albert/Benjamin] done","PASS: hdfs chown [/albert/Benjamin] done"]
    >       }
    >   },
    >   "notebooks": {
    >   "user": "Benjamin",
    >   "debug": {
    >       "script": "clone-notebooks.sh",
    >       "result": "PASS",
    >       "messages": ["PASS: Login [Benjamin] done","SKIP: Examples found [8]"]
    >       }
    >   }
    >   }


# -----------------------------------------------------
# Create a list of test users.
#[root@ansibler]

    source /deployments/zeppelin/bin/create-user-tools.sh

    testnames=(
        Hamar
        Carclop
        Halda
        Jaden
        Mavaca
        Franilley
        Masonania
        Webbbron
        Granwaler
        )

    createarrayusers \
        "${testnames[@]}" \
    | tee /tmp/testusers.json \
    | jq '.'

    >   {
    >     "users": [
    >       {
    >         "linuxuser": {
    >           "name": "Hamar",
    >           "type": "test",
    >           "home": "/home/Hamar",
    >           "uid": 20003,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Hamar] done",
    >               "PASS: mkdir [/home/Hamar/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Hamar] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Hamar",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "joMi1faivoh5vuNokeib",
    >           "hash": "$shiro1$SHA-256$500000$AJEIxu9S4XX94X59HTNfbw==$PZQuVtdTn4cFRu1uzaPPZ4VtlKcW9ykB2QLcZdcST0s=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Hamar",
    >           "owner": "Hamar",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Hamar] done",
    >               "PASS: hdfs chown [/albert/Hamar] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Hamar",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Hamar] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Hamar/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Hamar/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Hamar/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Hamar/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Hamar/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Hamar/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Hamar/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Hamar/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Carclop",
    >           "type": "test",
    >           "home": "/home/Carclop",
    >           "uid": 20004,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Carclop] done",
    >               "PASS: mkdir [/home/Carclop/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Carclop] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Carclop",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "ohy8ughahGaiX9Eeji1j",
    >           "hash": "$shiro1$SHA-256$500000$Rz55izTvq08e5MB38uX3uA==$4yBxaOX8Pp0gmb5+d0cvd/x7MlBG5Q7TIHioX1l3AjY=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Carclop",
    >           "owner": "Carclop",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Carclop] done",
    >               "PASS: hdfs chown [/albert/Carclop] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Carclop",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Carclop] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Carclop/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Carclop/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Carclop/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Carclop/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Carclop/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Carclop/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Carclop/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Carclop/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Halda",
    >           "type": "test",
    >           "home": "/home/Halda",
    >           "uid": 20005,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Halda] done",
    >               "PASS: mkdir [/home/Halda/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Halda] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Halda",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "ao7Miqu2abieca4Eisah",
    >           "hash": "$shiro1$SHA-256$500000$N8+FD8PWFVoYGkhA1hnSyw==$d6DXqyc/552wdSsOTP6W4pXJp3VTTXBTPuQ7S0Cz59w=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Halda",
    >           "owner": "Halda",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Halda] done",
    >               "PASS: hdfs chown [/albert/Halda] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Halda",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Halda] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Halda/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Halda/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Halda/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Halda/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Halda/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Halda/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Halda/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Halda/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Jaden",
    >           "type": "test",
    >           "home": "/home/Jaden",
    >           "uid": 20006,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Jaden] done",
    >               "PASS: mkdir [/home/Jaden/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Jaden] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Jaden",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "Xaiqu0ioc1pahPho1koo",
    >           "hash": "$shiro1$SHA-256$500000$ODiNRjNNCCHnDdwN93tXHA==$P+Ah7oftALFJ+yg2a3oeDMSsMYwVrnnNu0zbUl9jtfs=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Jaden",
    >           "owner": "Jaden",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Jaden] done",
    >               "PASS: hdfs chown [/albert/Jaden] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Jaden",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Jaden] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Jaden/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Jaden/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Jaden/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Jaden/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Jaden/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Jaden/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Jaden/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Jaden/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Mavaca",
    >           "type": "test",
    >           "home": "/home/Mavaca",
    >           "uid": 20007,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Mavaca] done",
    >               "PASS: mkdir [/home/Mavaca/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Mavaca] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Mavaca",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "Nae6Ohd1uYi7kei1iugi",
    >           "hash": "$shiro1$SHA-256$500000$1YSanpoUrmhhmlQza7iqig==$FpyLEU7ZGcBM/IMRk1qYcZa2wTu8EcYZcNpVbsiQYJ0=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Mavaca",
    >           "owner": "Mavaca",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Mavaca] done",
    >               "PASS: hdfs chown [/albert/Mavaca] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Mavaca",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Mavaca] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Mavaca/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Mavaca/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Mavaca/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Mavaca/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Mavaca/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Mavaca/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Mavaca/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Mavaca/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Franilley",
    >           "type": "test",
    >           "home": "/home/Franilley",
    >           "uid": 20008,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Franilley] done",
    >               "PASS: mkdir [/home/Franilley/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Franilley] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Franilley",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "iethio9ohr7eiGheuh6e",
    >           "hash": "$shiro1$SHA-256$500000$nCfv8ZoZfJ6w/v8249ljAw==$VvvHKfmOCHDK4WiFO6JNRgTSNWS1ivAYRaT3KLAccgg=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Franilley",
    >           "owner": "Franilley",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Franilley] done",
    >               "PASS: hdfs chown [/albert/Franilley] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Franilley",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Franilley] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Franilley/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Franilley/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Franilley/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Franilley/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Franilley/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Franilley/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Franilley/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Franilley/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Masonania",
    >           "type": "test",
    >           "home": "/home/Masonania",
    >           "uid": 20009,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Masonania] done",
    >               "PASS: mkdir [/home/Masonania/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Masonania] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Masonania",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "ahYeith1eepaiM3doong",
    >           "hash": "$shiro1$SHA-256$500000$utNn/91UBaghbYx/BQ1pZA==$elJyi/TkjElxkBRjIKTA08Nj5PTiuzoKl4DuCfbjtMM=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Masonania",
    >           "owner": "Masonania",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Masonania] done",
    >               "PASS: hdfs chown [/albert/Masonania] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Masonania",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Masonania] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Masonania/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Masonania/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Masonania/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Masonania/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Masonania/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Masonania/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Masonania/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Masonania/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Webbbron",
    >           "type": "test",
    >           "home": "/home/Webbbron",
    >           "uid": 20010,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Webbbron] done",
    >               "PASS: mkdir [/home/Webbbron/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Webbbron] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Webbbron",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "vie8eeFeeJe0AhZeegh1",
    >           "hash": "$shiro1$SHA-256$500000$5pdtWjb9Ean7MtlF+HKJng==$88B2WLKvdsK+3i0rxEquxMMg/BbbMaCoj5zJKe/HDmQ=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Webbbron",
    >           "owner": "Webbbron",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Webbbron] done",
    >               "PASS: hdfs chown [/albert/Webbbron] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Webbbron",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Webbbron] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Webbbron/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Webbbron/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Webbbron/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Webbbron/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Webbbron/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Webbbron/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Webbbron/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Webbbron/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Granwaler",
    >           "type": "test",
    >           "home": "/home/Granwaler",
    >           "uid": 20011,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: adduser [Granwaler] done",
    >               "PASS: mkdir [/home/Granwaler/.ssh] done",
    >               "PASS: adding public key for [zepelin] done",
    >               "SKIP: adding public key for [Granwaler] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Granwaler",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "tae7ohlahjohh1LeiP2e",
    >           "hash": "$shiro1$SHA-256$500000$le+LAp2mAIqreuZxI+i/Zg==$phrV835I2QlEHuH08cQqU9p8QymVbkCjvNqbgSX7sU8=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Granwaler",
    >           "owner": "Granwaler",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Granwaler] done",
    >               "PASS: hdfs chown [/albert/Granwaler] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Granwaler",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Granwaler] done",
    >               "PASS: Clone done [2GRTQZFUM][/Users/Granwaler/examples/1. Start here]",
    >               "PASS: Clone done [2GRA39HCN][/Users/Granwaler/examples/2. Data holdings]",
    >               "PASS: Clone done [2GQ6WMH9W][/Users/Granwaler/examples/3. Source counts over the sky]",
    >               "PASS: Clone done [2GSNYBDWB][/Users/Granwaler/examples/4. Mean proper motions over the sky]",
    >               "PASS: Clone done [2H2YRJCKM][/Users/Granwaler/examples/5. Working with Gaia XP spectra]",
    >               "PASS: Clone done [2GZME59KY][/Users/Granwaler/examples/6. Working with cross-matched surveys]",
    >               "PASS: Clone done [2GQDKZ59J][/Users/Granwaler/examples/7. Good astrometric solutions via ML Random Forrest classifier]",
    >               "PASS: Clone done [2GVXKC266][/Users/Granwaler/examples/8. Tips and tricks]"
    >             ]
    >           }
    >         }
    >       }
    >     ]
    >   }


# -----------------------------------------------------
# Duplicate some of the test users.
#[root@ansibler]

    source /deployments/zeppelin/bin/create-user-tools.sh

    testnames=(
        Carclop
        Jaden
        Franilley
        Webbbron
        )

    createarrayusers \
        "${testnames[@]}" \
    | tee /tmp/testusers.json \
    | jq '.'


    >   {
    >     "users": [
    >       {
    >         "linuxuser": {
    >           "name": "Carclop",
    >           "type": "test",
    >           "home": "/home/Carclop",
    >           "uid": 20012,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Carclop] skipped (done)",
    >               "SKIP: mkdir [/home/Carclop/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Carclop] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Carclop",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "tohzaireiwooquoiS2ti",
    >           "hash": "$shiro1$SHA-256$500000$ablNn/BGB9GP1X1CXNfCkw==$PFtVXEMbTMM5WsS+U8tjn8ulo5HE7THbPnK4nwP/T6o=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Carclop",
    >           "owner": "Carclop",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Carclop] done",
    >               "PASS: hdfs chown [/albert/Carclop] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Carclop",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Carclop] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Jaden",
    >           "type": "test",
    >           "home": "/home/Jaden",
    >           "uid": 20012,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Jaden] skipped (done)",
    >               "SKIP: mkdir [/home/Jaden/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Jaden] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Jaden",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "Ageecaeme6zaingie4Gi",
    >           "hash": "$shiro1$SHA-256$500000$SIWgYYjIWbNIFRvwNwi6HA==$G3a3SJWvWs+Tu+1aS4VCJZRfmZ4bCBeoDodvwO81fes=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Jaden",
    >           "owner": "Jaden",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Jaden] done",
    >               "PASS: hdfs chown [/albert/Jaden] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Jaden",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Jaden] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Franilley",
    >           "type": "test",
    >           "home": "/home/Franilley",
    >           "uid": 20012,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Franilley] skipped (done)",
    >               "SKIP: mkdir [/home/Franilley/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Franilley] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Franilley",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "iejoibaeRoimohvamoo9",
    >           "hash": "$shiro1$SHA-256$500000$6aQ51A4gG3SKMUYemXn7bg==$DLorJTcmi54ItNmCJi+GvoXXPzCJeMT+i2Vn//g+yF8=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Franilley",
    >           "owner": "Franilley",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Franilley] done",
    >               "PASS: hdfs chown [/albert/Franilley] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Franilley",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Franilley] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Webbbron",
    >           "type": "test",
    >           "home": "/home/Webbbron",
    >           "uid": 20012,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Webbbron] skipped (done)",
    >               "SKIP: mkdir [/home/Webbbron/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Webbbron] skipped (no key)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Webbbron",
    >           "type": "test",
    >           "role": "user",
    >           "pass": "KaiXeeB3veugu9tieyae",
    >           "hash": "$shiro1$SHA-256$500000$5htFTKlbzVowImZi+HLUwQ==$7d7aJnZ1Imuk73VCqEujCyfAgjtAQdTPBSmRGdr6El4=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Webbbron",
    >           "owner": "Webbbron",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Webbbron] done",
    >               "PASS: hdfs chown [/albert/Webbbron] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Webbbron",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Webbbron] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       }
    >     ]
    >   }


    jq '
        [ .users[] | {"name": .shirouser.name, "pass": .shirouser.pass} ]
        ' '/tmp/testusers.json'

    >   [
    >     {
    >       "name": "Carclop",
    >       "pass": "tohzaireiwooquoiS2ti"
    >     },
    >     {
    >       "name": "Jaden",
    >       "pass": "Ageecaeme6zaingie4Gi"
    >     },
    >     {
    >       "name": "Franilley",
    >       "pass": "iejoibaeRoimohvamoo9"
    >     },
    >     {
    >       "name": "Webbbron",
    >       "pass": "KaiXeeB3veugu9tieyae"
    >     }
    >   ]


# -----------------------------------------------------
# Create some realistic users.
#[root@ansibler]

    yamlfile="/tmp/users.yml"
    yamlpath="people"

    cat > "${yamlfile}" << EOF

before:

  - name: "Chavezlafia"
    uid:  20053

  - name: "Ellisiri"
    uid:  20054

  - name: "Gonzatt"
    uid:  20055

people:

  - name: "Nelia"
    type: "nice"
    pass: "yee8hohqu5ipae4Zie8x"
    hash: "$shiro1$SHA-256$500000$4fJW1JCupaW8ykH1vikEug==$8eIVAtxlZ9ElmcaVQyHBGFdR+a/NZ4rovGsi/ZGCe/8="
    pkey: "$(cat /deployments/common/ssh/keys/dcr.roe.ac.uk.rsa.pub)"
    uid:  30000
    data:
      size: 120
      uuid: "fb80a90e-8a2e-4ad9-8550-0e9ad55d3bc7"

  - name: "Nala"
    type: "nice"
    pass: "yee8hohqu5ipae4Zie8x"
    pkey: "$(cat /deployments/common/ssh/keys/dmr.roe.ac.uk.rsa.pub)"
    uid:  30001
    data:
      size: 120

  - name: "Ghoria"
    type: "nice"
    hash: "$shiro1$SHA-256$500000$yCIXjCpdiV29yvImr6BAjA==$4h8S08tLNm2DDZn0xLnG3+Mnx81Fhc7csHqjwGLEj4M="
    pkey: "$(cat /deployments/common/ssh/keys/nch.roe.ac.uk.rsa.pub)"
    uid:  30002
    data:
      uuid: "e5fbfaf3-a062-4249-ae82-6fb6a412dae7"

  - name: "Piri"
    type: "nice"
    pkey: "$(cat /deployments/common/ssh/keys/stv.roe.ac.uk.rsa.pub)"
    uid:  30000

after:

  - name: "Wenia"
    uid:  2053

  - name: "Ava"

EOF


    source /deployments/zeppelin/bin/create-user-tools.sh

    createyamlusers "/tmp/users.yml" "people" \
    | jq '.'

    >   {
    >     "users": [
    >       {
    >         "linuxuser": {
    >           "name": "Nelia",
    >           "type": "nice",
    >           "home": "/home/Nelia",
    >           "uid": 30000,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Nelia] skipped (done)",
    >               "SKIP: mkdir [/home/Nelia/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Nelia] skipped (done)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Nelia",
    >           "type": "nice",
    >           "role": "user",
    >           "pass": "yee8hohqu5ipae4Zie8x",
    >           "hash": "$shiro1$SHA-256$500000$4fJW1JCupaW8ykH1vikEug==$8eIVAtxlZ9ElmcaVQyHBGFdR+a/NZ4rovGsi/ZGCe/8=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Nelia",
    >           "owner": "Nelia",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Nelia] done",
    >               "PASS: hdfs chown [/albert/Nelia] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Nelia",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Nelia] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Nala",
    >           "type": "nice",
    >           "home": "/home/Nala",
    >           "uid": 30001,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Nala] skipped (done)",
    >               "SKIP: mkdir [/home/Nala/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Nala] skipped (done)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Nala",
    >           "type": "nice",
    >           "role": "user",
    >           "pass": "Ahchae0Sa8ahJoo1vaej",
    >           "hash": "$shiro1$SHA-256$500000$yCIXjCpdiV29yvImr6BAjA==$4h8S08tLNm2DDZn0xLnG3+Mnx81Fhc7csHqjwGLEj4M=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Nala",
    >           "owner": "Nala",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Nala] done",
    >               "PASS: hdfs chown [/albert/Nala] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Nala",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Nala] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Ghoria",
    >           "type": "nice",
    >           "home": "/home/Ghoria",
    >           "uid": 30002,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Ghoria] skipped (done)",
    >               "SKIP: mkdir [/home/Ghoria/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Ghoria] skipped (done)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Ghoria",
    >           "type": "nice",
    >           "role": "user",
    >           "pass": "xed0thie8Bu8queiz3pe",
    >           "hash": "$shiro1$SHA-256$500000$vsJj8HiQQcKnBVeNuM+g/w==$8v5jcufWtxv2kVGacOLsydhyx7iZCpJqJ7YcjxjNV7U=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Ghoria",
    >           "owner": "Ghoria",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Ghoria] done",
    >               "PASS: hdfs chown [/albert/Ghoria] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Ghoria",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Ghoria] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       },
    >       {
    >         "linuxuser": {
    >           "name": "Piri",
    >           "type": "nice",
    >           "home": "",
    >           "uid": 30000,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "FAIL",
    >             "messages": [
    >               "FAIL: adduser [Piri] failed",
    >               "adduser: UID 30000 is not unique",
    >               "SKIP: mkdir [/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Piri] skipped (done)",
    >               "FAIL: chown [/.ssh] failed",
    >               "chown: invalid user: Piri:Piri"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Piri",
    >           "type": "nice",
    >           "role": "user",
    >           "pass": "Zohrubaeb9Uer5thie4i",
    >           "hash": "$shiro1$SHA-256$500000$OZTU/1Zxt9c+u2V9KDVkQw==$IYOHrAztPGgU5SiYB99MEKQwHW2bow3J4V53HY0pMw8=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Piri",
    >           "owner": "Piri",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Piri] done",
    >               "PASS: hdfs chown [/albert/Piri] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Piri",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Piri] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       }
    >     ]
    >   }

    #
    # Loop works OK, but some values are wrong.
    # FAIL - Password gets changed when it should't.
    #

# -----------------------------------------------------
# test specific fields.
#[root@ansibler]

    cat > "/tmp/test-user.yml" << EOF
testers:
  - name: "Nelia"
    type: "nice"
    pass: "yee8hohqu5ipae4Zie8x"
    hash: "$shiro1$SHA-256$500000$4fJW1JCupaW8ykH1vikEug==$8eIVAtxlZ9ElmcaVQyHBGFdR+a/NZ4rovGsi/ZGCe/8="
    pkey: "$(cat /deployments/common/ssh/keys/dcr.roe.ac.uk.rsa.pub)"
    uid:  30000
    data:
      size: 120
      uuid: "fb80a90e-8a2e-4ad9-8550-0e9ad55d3bc7"
EOF

    source /deployments/zeppelin/bin/create-user-tools.sh

    createyamlusers "/tmp/test-user.yml" "testers" \
    | jq '.'

    >   {
    >     "users": [
    >       {
    >         "linuxuser": {
    >           "name": "Nelia",
    >           "type": "nice",
    >           "home": "/home/Nelia",
    >           "uid": 30000,
    >           "debug": {
    >             "script": "create-linux-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "SKIP: adduser [Nelia] skipped (done)",
    >               "SKIP: mkdir [/home/Nelia/.ssh] skipped (done)",
    >               "SKIP: adding public key for [zeppelin] skipped (done)",
    >               "SKIP: adding public key for [Nelia] skipped (done)"
    >             ]
    >           }
    >         },
    >         "shirouser": {
    >           "name": "Nelia",
    >           "type": "nice",
    >           "role": "user",
    >           "pass": "gainee1meeNgee4Aepho",
    >           "hash": "$shiro1$SHA-256$500000$FtiVgqb60xhHY37YXxa9Hg==$nFauDeIxCGUYLoafrLd5YQICrRVGs7oKhB9ifglOFiU=",
    >           "debug": {
    >             "script": "create-shiro-user.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: passgen done",
    >               "PASS: hashpass done",
    >               "PASS: database INSERT done"
    >             ]
    >           }
    >         },
    >         "hdfsspace": {
    >           "path": "/albert/Nelia",
    >           "owner": "Nelia",
    >           "group": "supergroup",
    >           "debug": {
    >             "script": "create-hdfs-space.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: hdfs mkdir [/albert/Nelia] done",
    >               "PASS: hdfs chown [/albert/Nelia] done"
    >             ]
    >           }
    >         },
    >         "notebooks": {
    >           "user": "Nelia",
    >           "debug": {
    >             "script": "clone-notebooks.sh",
    >             "result": "PASS",
    >             "messages": [
    >               "PASS: Login [Nelia] done",
    >               "SKIP: Examples found [8]"
    >             ]
    >           }
    >         }
    >       }
    >     ]
    >   }

    #
    # FAIL - Password gets changed when it should't.
    #

